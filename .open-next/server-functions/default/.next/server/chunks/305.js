exports.id=305,exports.ids=[305],exports.modules={857:(a,b,c)=>{"use strict";c.d(b,{WX:()=>f,cR:()=>e});var d=c(2190);function e(){let a=function(){try{let a=globalThis[Symbol.for("__cloudflare-context__")];if(a?.env)return!0}catch(a){}return"undefined"!=typeof process&&(!!process.env.DEPLOYMENT_ID||!!process.env.CF_PAGES_URL||!!process.env.CF_PAGES||!!process.env.CF_PAGES_BRANCH||!!process.env.CF_PAGES_COMMIT_SHA||"development"!==process.env.NEXTJS_ENV||!!process.env.DB&&!!1)||"undefined"!=typeof globalThis&&!!globalThis.caches&&"function"==typeof globalThis.caches.open}(),b=!a&&"undefined"!=typeof process&&!1;return{environment:a?"cloudflare":"local",isCloudflare:a,isDevelopment:b,nodeEnv:"undefined"!=typeof process||a?"production":"unknown"}}function f(a,b,c){let f,g=e(),h=a?.message||String(a),i=a?.name||"UnknownError";console.error("=== ERROR DETAILS ===",{environment:g.environment,route:c?.route||"unknown",method:c?.method||"unknown",operation:c?.operation||"unknown",errorName:i,errorMessage:h,errorMessageLength:h?.length,errorMessageExact:JSON.stringify(h),stack:a?.stack,fullError:String(a),timestamp:new Date().toISOString()});let j=500,k=b;"Database not available"===h||"DB not available"===h||"Base de datos no disponible"===h||h.includes("D1")&&h.includes("not available")||h.includes("binding")&&h.includes("not found")||h.includes("D1 Database binding")&&h.includes("not found")?(j=503,k="Base de datos no disponible",f=g.isCloudflare?"Error de configuraci\xf3n: La base de datos D1 no est\xe1 configurada correctamente en Cloudflare Pages. Verifica el binding en el dashboard.":"Error de configuraci\xf3n: La base de datos no est\xe1 disponible en el entorno local."):h.includes("UNIQUE constraint")||h.includes("constraint")?(j=400,k=h.includes("email")?"El email ya existe":h.includes("reserva")||h.includes("clase")?"Ya existe un registro con estos datos":"Datos duplicados"):h.includes("Faltan")||h.includes("required")||h.includes("invalid")?(j=400,k=h.includes("Faltan")?h:"Datos inv\xe1lidos"):h.includes("Cloudflare")||h.includes("edge runtime")||h.includes("getOptionalRequestContext")?(j=500,k="Error del servidor (Cloudflare)",f=g.isCloudflare?"Error en el runtime de Cloudflare. Verifica la configuraci\xf3n del proyecto.":"Error de compatibilidad con Cloudflare Pages."):(j=500,k=b,g.isDevelopment&&(f=h));let l={error:k,environment:g.environment,timestamp:new Date().toISOString()};return(f||g.isDevelopment)&&(l.details=f||h),g.isDevelopment&&(l.debug={errorName:i,route:c?.route,method:c?.method,operation:c?.operation}),d.NextResponse.json(l,{status:j})}},6487:()=>{},8335:()=>{},9949:(a,b,c)=>{"use strict";function d(a){if(!a||!a.id||a.dni)return null;let b=String(a.apellido||"").trim(),c=String(a.nombre||"").trim();if(!c||!b)return null;let d={};return d.id=Number(a.id),d.nombre=c,d.apellido=b,d.telefono=a.telefono?String(a.telefono).trim():"",d.fecha_alta=a.fecha_alta?String(a.fecha_alta).trim():new Date().toISOString().split("T")[0],0===a.activo||!1===a.activo?d.activo=!1:d.activo=!0,d}function e(){let a;"undefined"!=typeof globalThis?(globalThis.__mockDBData||(globalThis.__mockDBData={usuarios:[],clases:[],reservas:[]}),a=globalThis.__mockDBData):(global.__mockDBData||(global.__mockDBData={usuarios:[],clases:[],reservas:[]}),a=global.__mockDBData);let b=a.usuarios.filter(a=>!a||!a.dni).map(a=>d(a)).filter(a=>null!==a);return a.usuarios=b.filter(a=>null!==a),a}c.d(b,{O:()=>g});class f{get data(){return e()}prepare(a){return{bind:(...b)=>{let c=Array.isArray(b[0])?b[0]:b;return{first:async()=>{let b=e();if(a.includes("SELECT COUNT(*)")){if(a.includes("FROM reserva")&&a.includes("WHERE clase_id")){let a=c&&c.length>0?parseInt(c[0]):null;if(null!==a)return{count:b.reservas.filter(b=>b.clase_id===a).length}}if(a.includes("FROM clase"))return{count:b.clases.length};if(a.includes("FROM usuario"))return{count:b.usuarios.length};if(a.includes("FROM reserva"))return{count:b.reservas.length}}if(a.includes("SELECT")&&a.includes("WHERE")){if(a.includes("FROM usuario")&&a.includes("id")){let a=b.usuarios.find(a=>a.id===parseInt(c[0]));return a?d(a):null}if(a.includes("SELECT")&&a.includes("FROM reserva")&&a.includes("WHERE usuario_id")&&a.includes("clase_id")&&a.includes("AND")&&c&&c.length>=2){let a=Number(c[0]),d=Number(c[1]);return b.reservas.find(b=>{let c=Number(b.usuario_id),e=Number(b.clase_id);return c===a&&e===d})||null}}return null},all:async()=>{let b=e();if(a.includes("FROM usuario")){let c=b.usuarios.filter(a=>!a||!a.dni).map(a=>d(a)).filter(a=>null!==a);return a.includes("ORDER BY")&&a.includes("ORDER BY apellido, nombre")&&c.sort((a,b)=>{let c=(a.apellido||"").localeCompare(b.apellido||"");return 0!==c?c:(a.nombre||"").localeCompare(b.nombre||"")}),{results:c}}if(a.includes("FROM clase")){let c=[...b.clases];if(a.includes("ORDER BY dia, hora")){let a={Lun:1,Mar:2,Jue:3,Sab:4};c.sort((b,c)=>{let d=a[b.dia]||99,e=a[c.dia]||99;return d!==e?d-e:(b.hora||"").localeCompare(c.hora||"")})}return{results:c}}if(a.includes("FROM reserva")){let e=[];if(a.includes("JOIN usuario")||a.includes("JOIN clase")){let f=a.includes("WHERE")&&a.includes("activo")&&(a.includes("= 1")||a.includes("u.activo = 1"));for(let a of b.reservas){let c=b.usuarios.find(b=>b.id===a.usuario_id),g=b.clases.find(b=>b.id===a.clase_id);if(f&&c){let a=d(c);if(!a||!a.activo)continue}c&&g&&e.push({...a,nombre:c.nombre,apellido:c.apellido,dia:g.dia,hora:g.hora,clase_nombre:g.nombre})}if(a.includes("WHERE")&&c.length>0){if(a.includes("r.usuario_id = ?")||a.includes("usuario_id = ?")){let b=a.indexOf("usuario_id = ?");if(-1!==b){let d=(a.substring(0,b).match(/\?/g)||[]).length;void 0!==c[d]&&(e=e.filter(a=>Number(a.usuario_id)===Number(c[d])))}}if(a.includes("r.clase_id = ?")||a.includes("clase_id = ?")){let b=a.indexOf("clase_id = ?");if(-1!==b){let d=(a.substring(0,b).match(/\?/g)||[]).length;void 0!==c[d]&&(e=e.filter(a=>Number(a.clase_id)===Number(c[d])))}}}}else e=[...b.reservas];if(a.includes("ORDER BY")&&a.includes("ORDER BY c.dia, c.hora")){let a={Lun:1,Mar:2,Jue:3,Sab:4};e.sort((b,c)=>{let d=a[b.dia]||99,e=a[c.dia]||99;return d!==e?d-e:(b.hora||"").localeCompare(c.hora||"")})}return{results:e}}return{results:[]}},run:async()=>{let b=e();try{if(a.includes("INSERT INTO usuario")){let a=b.usuarios.length>0?Math.max(...b.usuarios.map(a=>a.id||0)):0;if(c.length<3)throw Error("Faltan par\xe1metros requeridos");let e=String(c[0]||"").trim(),f=String(c[1]||"").trim(),g=String(c[2]||"").trim(),h=c[3]?String(c[3]).trim():new Date().toISOString().split("T")[0],i=void 0===c[4]||1===c[4]||!0===c[4];if(!e||!f||!g)throw Error("Faltan campos requeridos");let j={};return j.id=a+1,j.nombre=e,j.apellido=f,j.telefono=g,j.fecha_alta=h,j.activo=+!!i,b.usuarios=b.usuarios.map(a=>d(a)).filter(a=>null!==a),b.usuarios.push(j),{success:!0,meta:{last_row_id:j.id,changes:1}}}if(a.includes("INSERT INTO clase")){let a={id:(b.clases.length>0?Math.max(...b.clases.map(a=>a.id||0)):0)+1,dia:c[0],hora:c[1],nombre:c[2]||"Yoga"},d=b.clases.findIndex(b=>b.dia===a.dia&&b.hora===a.hora);if(-1===d)return b.clases.push(a),{success:!0,meta:{last_row_id:a.id,changes:1}};throw Error("UNIQUE constraint failed: clase.dia, clase.hora")}if(a.includes("INSERT INTO reserva")){let a={usuario_id:Number(c[0]),clase_id:Number(c[1]),created_at:c[2]||new Date().toISOString()},d=b.usuarios.find(b=>Number(b.id)===a.usuario_id);if(!d){let a=Error("El alumno no existe");throw a.code="USUARIO_NO_EXISTE",a}if(!0!==d.activo&&1!==d.activo){let a=Error("No se pueden inscribir alumnos desactivados a clases");throw a.code="USUARIO_DESACTIVADO",a}let e=b.reservas.findIndex(b=>Number(b.usuario_id)===a.usuario_id&&Number(b.clase_id)===a.clase_id);if(-1!==e)throw Error("UNIQUE constraint failed: reserva.usuario_id, reserva.clase_id");let f=b.reservas.filter(b=>Number(b.clase_id)===a.clase_id);if(f.length>=35){let a=Error(`Esta clase ya tiene el cupo completo (35 alumnos). No se pueden inscribir m\xe1s alumnos.`);throw a.code="CUPO_COMPLETO",a.cupoMaximo=35,a.cupoActual=f.length,a}return b.reservas.push(a),{success:!0,meta:{changes:1}}}if(a.includes("UPDATE usuario")){if(a.includes("SET activo = ?")&&a.includes("WHERE id = ?")){let a=1===c[0]||!0===c[0],d=c[1],e=b.usuarios.findIndex(a=>Number(a.id)===Number(d));if(-1!==e)return b.usuarios[e].activo=+!!a,{success:!0,meta:{changes:1}};return{success:!0,meta:{changes:0}}}if(c.length>=6){let a=c[5],d=b.usuarios.findIndex(b=>Number(b.id)===Number(a));if(-1!==d){let a=void 0===c[4]||1===c[4]||!0===c[4];return b.usuarios[d]={...b.usuarios[d],nombre:c[0],apellido:c[1],telefono:c[2],fecha_alta:c[3],activo:+!!a},{success:!0,meta:{changes:1}}}}return{success:!0,meta:{changes:0}}}if(a.includes("UPDATE clase"),a.includes("UPDATE reserva"),a.includes("DELETE FROM usuario")){let a=b.usuarios.length;b.usuarios=b.usuarios.filter(a=>a.id!==parseInt(c[0]));let d=a-b.usuarios.length;return{success:!0,meta:{changes:d}}}if(a.includes("DELETE FROM clase")&&(b.clases=b.clases.filter(a=>a.id!==parseInt(c[0]))),a.includes("DELETE FROM reserva")){let a=b.reservas.length;b.reservas=b.reservas.filter(a=>a.usuario_id!==parseInt(c[0])||a.clase_id!==parseInt(c[1]));let d=a-b.reservas.length;return{success:!0,meta:{changes:d}}}return{success:!0,meta:{changes:0}}}catch(a){throw a}}}},first:async()=>{let b=e();if(a.includes("SELECT COUNT(*)")){if(a.includes("FROM clase"))return{count:b.clases.length};if(a.includes("FROM usuario"))return{count:b.usuarios.length};if(a.includes("FROM reserva")&&!a.includes("WHERE"))return{count:b.reservas.length}}return a.includes("SELECT")&&a.includes("WHERE")&&a.includes("usuario")&&a.includes("id"),null},all:async()=>{let b=e();if(a.includes("FROM usuario")){let c=b.usuarios.filter(a=>!a||!a.dni).map(a=>d(a)).filter(a=>null!==a);return a.includes("ORDER BY")&&a.includes("ORDER BY apellido, nombre")&&c.sort((a,b)=>{let c=(a.apellido||"").localeCompare(b.apellido||"");return 0!==c?c:(a.nombre||"").localeCompare(b.nombre||"")}),{results:c}}if(a.includes("FROM clase")){let c=[...b.clases];if(a.includes("ORDER BY dia, hora")){let a={Lun:1,Mar:2,Jue:3,Sab:4};c.sort((b,c)=>{let d=a[b.dia]||99,e=a[c.dia]||99;return d!==e?d-e:(b.hora||"").localeCompare(c.hora||"")})}return{results:c}}if(a.includes("FROM reserva")){let c=[];if(a.includes("JOIN usuario")||a.includes("JOIN clase")){let d=a.includes("WHERE")&&a.includes("activo")&&a.includes("= 1");for(let a of b.reservas){let e=b.usuarios.find(b=>b.id===a.usuario_id),f=b.clases.find(b=>b.id===a.clase_id);(!d||!e||e.activo&&0!==e.activo)&&e&&f&&c.push({...a,nombre:e.nombre,apellido:e.apellido,dia:f.dia,hora:f.hora,clase_nombre:f.nombre})}}else c=[...b.reservas];return{results:c}}return{results:[]}},run:async()=>{e(),a.includes("INSERT INTO usuario")}}}}function g(){return"undefined"!=typeof globalThis?(globalThis.__mockDBInstance||(globalThis.__mockDBInstance=new f),globalThis.__mockDBInstance):(global.__mockDBInstance||(global.__mockDBInstance=new f),global.__mockDBInstance)}}};