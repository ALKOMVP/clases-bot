(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[634],{2712:(e,a,s)=>{"use strict";async function r(e,a){let s="Error desconocido",r=null;try{let a=e.headers.get("content-type");s=a&&a.includes("application/json")?(null==(r=await e.json())?void 0:r.error)||s:await e.text()||"HTTP ".concat(e.status,": ").concat(e.statusText)}catch(a){s="Error al procesar respuesta: ".concat(e.status," ").concat(e.statusText)}console.error("=== API ERROR ===",{route:a.route,operation:a.operation,status:e.status,statusText:e.statusText,errorDetails:r,timestamp:new Date().toISOString()});let t=s;if(r){var l,i,o;((null==(l=r.details)?void 0:l.includes("Database"))||(null==(i=r.details)?void 0:i.includes("D1"))||(null==(o=r.details)?void 0:o.includes("binding")))&&(t="Error de base de datos: "+s,"cloudflare"===r.environment&&(t+="\n\nVerifica la configuraci\xf3n de D1 en Cloudflare Pages.")),r.details&&r.details!==s&&(console.error("Error details:",r.details),"localhost"===window.location.hostname&&(t+="\n\nDetalles: ".concat(r.details))),r.debug&&console.error("Debug info:",r.debug)}return t}async function t(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;try{let t=await fetch(e,a);if(!t.ok){let e=await r(t,s);throw Error(e)}return t}catch(e){if("TypeError"===e.name&&e.message.includes("fetch"))throw console.error("=== NETWORK ERROR ===",{route:s.route,operation:s.operation,error:e.message,timestamp:new Date().toISOString()}),Error("Error de conexi\xf3n. Verifica tu conexi\xf3n a internet o si el servidor est\xe1 disponible.");throw e}}s.d(a,{q:()=>t})},5538:(e,a,s)=>{Promise.resolve().then(s.bind(s,8251))},7969:(e,a,s)=>{"use strict";s.d(a,{A:()=>o});var r=s(5155),t=s(6874),l=s.n(t),i=s(5695);function o(){let e=(0,i.useRouter)(),a=async()=>{await fetch("/api/auth/logout",{method:"POST"}),e.push("/login"),e.refresh()};return(0,r.jsx)("nav",{className:"bg-purple-600 text-white shadow-lg",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between h-16",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-8",children:[(0,r.jsx)(l(),{href:"/",className:"text-xl font-bold",children:"Clases Bot"}),(0,r.jsx)(l(),{href:"/usuarios",className:"hover:text-purple-200 transition-colors",children:"Alumnos"}),(0,r.jsx)(l(),{href:"/clases",className:"hover:text-purple-200 transition-colors",children:"Clases"}),(0,r.jsx)(l(),{href:"/reservas",className:"hover:text-purple-200 transition-colors",children:"Reservas"})]}),(0,r.jsx)("button",{onClick:a,className:"hover:text-purple-200 transition-colors",children:"Cerrar Sesi\xf3n"})]})})})}},8251:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>o});var r=s(5155),t=s(2115),l=s(7969),i=s(2712);function o(){let[e,a]=(0,t.useState)([]),[s,o]=(0,t.useState)([]),[n,c]=(0,t.useState)([]),[d,u]=(0,t.useState)(!1),[x,m]=(0,t.useState)(!1),[p,h]=(0,t.useState)(null),[g,b]=(0,t.useState)(null),[y,f]=(0,t.useState)(""),[v,j]=(0,t.useState)({id:0,nombre:"",apellido:"",email:"",fecha_alta:new Date().toISOString().split("T")[0]});(0,t.useEffect)(()=>{N(),w(),E()},[]);let N=async()=>{try{let e=await (0,i.q)("/api/usuarios",{},{route:"/api/usuarios",operation:"load_usuarios"}),s=await e.json();Array.isArray(s)?a(s):(console.warn("loadUsuarios: Response is not an array",s),a([]))}catch(e){console.error("Error loading usuarios:",e),alert(e.message||"Error al cargar usuarios"),a([])}},w=async()=>{try{let e=await (0,i.q)("/api/clases",{},{route:"/api/clases",operation:"load_clases"}),a=await e.json();Array.isArray(a)?o(a):(console.warn("loadClases: Response is not an array",a),o([]))}catch(e){console.error("Error loading clases:",e),alert(e.message||"Error al cargar clases"),o([])}},E=async()=>{try{let e=await (0,i.q)("/api/reservas",{},{route:"/api/reservas",operation:"load_reservas"}),a=await e.json();Array.isArray(a)?c(a):(console.warn("loadReservas: Response is not an array",a),c([]))}catch(e){console.error("Error loading reservas:",e),alert(e.message||"Error al cargar reservas"),c([])}},C=async e=>{e.preventDefault();let a=g?v:{nombre:v.nombre,apellido:v.apellido,email:v.email,fecha_alta:v.fecha_alta};try{await (0,i.q)("/api/usuarios",{method:g?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)},{route:"/api/usuarios",operation:g?"update_usuario":"create_usuario"}),u(!1),b(null),j({id:0,nombre:"",apellido:"",email:"",fecha_alta:new Date().toISOString().split("T")[0]}),N()}catch(e){alert(e.message||"Error al guardar")}},_=async e=>{if(confirm("\xbfEst\xe1s seguro de eliminar este alumno?"))try{await (0,i.q)("/api/usuarios?id=".concat(e),{method:"DELETE"},{route:"/api/usuarios",operation:"delete_usuario"}),N(),E()}catch(e){alert(e.message||"Error al eliminar")}},S=async e=>{if(!p)return;let a=n.find(a=>a.usuario_id===p.id&&a.clase_id===e);try{a?await (0,i.q)("/api/reservas?usuario_id=".concat(p.id,"&clase_id=").concat(e),{method:"DELETE"},{route:"/api/reservas",operation:"delete_reserva"}):await (0,i.q)("/api/reservas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({usuario_id:p.id,clase_id:e})},{route:"/api/reservas",operation:"create_reserva"}),E()}catch(e){alert(e.message||"Error al modificar reserva")}},k=e=>({Lun:"Lunes",Mar:"Martes",Jue:"Jueves",Sab:"S\xe1bado"})[e]||e,T=e=>n.filter(a=>a.usuario_id===e).map(e=>{let a=s.find(a=>a.id===e.clase_id);return a?"".concat(k(a.dia)," ").concat(a.hora):""}).filter(Boolean).join(", ")||"Ninguna",A=e.filter(e=>{if(!y)return!0;let a=y.toLowerCase();return e.nombre.toLowerCase().includes(a)||e.apellido.toLowerCase().includes(a)||e.email.toLowerCase().includes(a)||T(e.id).toLowerCase().includes(a)});return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)(l.A,{}),(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold text-gray-900",children:"Alumnos"}),(0,r.jsx)("button",{onClick:()=>{u(!0),b(null),j({id:0,nombre:"",apellido:"",email:"",fecha_alta:new Date().toISOString().split("T")[0]})},className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors",children:"+ Nuevo Alumno"})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"text",placeholder:"Buscar por nombre, apellido, email o clases...",value:y,onChange:e=>f(e.target.value),className:"w-full px-4 py-2 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"}),(0,r.jsx)("svg",{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),y&&(0,r.jsx)("button",{onClick:()=>f(""),className:"absolute right-3 top-2.5 text-gray-400 hover:text-gray-600",children:"✕"})]}),y&&(0,r.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:["Mostrando ",A.length," de ",e.length," alumnos"]})]}),d&&(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:g?"Editar Alumno":"Nuevo Alumno"}),(0,r.jsxs)("form",{onSubmit:C,className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre *"}),(0,r.jsx)("input",{type:"text",value:v.nombre,onChange:e=>j({...v,nombre:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apellido *"}),(0,r.jsx)("input",{type:"text",value:v.apellido,onChange:e=>j({...v,apellido:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),(0,r.jsx)("input",{type:"email",value:v.email,onChange:e=>j({...v,email:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha de Alta"}),(0,r.jsx)("input",{type:"date",value:v.fecha_alta,onChange:e=>j({...v,fecha_alta:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0})]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{type:"submit",className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700",children:"Guardar"}),(0,r.jsx)("button",{type:"button",onClick:()=>{u(!1),b(null)},className:"bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400",children:"Cancelar"})]})]})]}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Nombre"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Apellido"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Email"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Clases Inscritas"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:A.map(e=>{let a=T(e.id);return(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.nombre}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.apellido}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.email}),(0,r.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900",children:(0,r.jsx)("div",{className:"max-w-xs truncate",title:a,children:a})}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[(0,r.jsx)("button",{onClick:()=>{h(e),m(!0)},className:"text-blue-600 hover:text-blue-900 mr-3",title:"Ver y gestionar reservas de clases",children:"Reservas"}),(0,r.jsx)("button",{onClick:()=>{b(e),j(e),u(!0)},className:"text-purple-600 hover:text-purple-900 mr-3",children:"Editar"}),(0,r.jsx)("button",{onClick:()=>_(e.id),className:"text-red-600 hover:text-red-900",children:"Eliminar"})]})]},e.id)})})]})}),x&&p&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsxs)("h2",{className:"text-2xl font-semibold",children:["Reservas de ",p.nombre," ",p.apellido]}),(0,r.jsx)("button",{onClick:()=>{m(!1),h(null)},className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),(0,r.jsx)("div",{className:"space-y-2",children:s.map(e=>{let a=n.some(a=>a.usuario_id===p.id&&a.clase_id===e.id);return(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border-2 ".concat(a?"bg-green-50 border-green-300":"bg-gray-50 border-gray-200"),children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:k(e.dia)}),(0,r.jsx)("span",{className:"ml-2 text-gray-600",children:e.hora}),(0,r.jsxs)("span",{className:"ml-2 text-sm text-gray-500",children:["- ",e.nombre]})]}),(0,r.jsx)("button",{onClick:()=>S(e.id),className:"px-4 py-2 rounded-lg text-sm font-medium ".concat(a?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"),children:a?"Desinscribir":"Inscribir"})]},e.id)})})]})})})]})]})}}},e=>{e.O(0,[244,441,964,358],()=>e(e.s=5538)),_N_E=e.O()}]);