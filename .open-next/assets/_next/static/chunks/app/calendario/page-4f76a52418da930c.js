(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[277],{2712:(e,a,s)=>{"use strict";async function t(e,a){let s="Error desconocido",t=null;try{let a=e.headers.get("content-type");s=a&&a.includes("application/json")?(null==(t=await e.json())?void 0:t.error)||s:await e.text()||"HTTP ".concat(e.status,": ").concat(e.statusText)}catch(a){s="Error al procesar respuesta: ".concat(e.status," ").concat(e.statusText)}console.error("=== API ERROR ===",{route:a.route,operation:a.operation,status:e.status,statusText:e.statusText,errorDetails:t,timestamp:new Date().toISOString()});let r=s;if(t){var l,n,o;((null==(l=t.details)?void 0:l.includes("Database"))||(null==(n=t.details)?void 0:n.includes("D1"))||(null==(o=t.details)?void 0:o.includes("binding")))&&(r="Error de base de datos: "+s,"cloudflare"===t.environment&&(r+="\n\nVerifica la configuraci\xf3n de D1 en Cloudflare Pages.")),t.details&&t.details!==s&&(console.error("Error details:",t.details),"localhost"===window.location.hostname&&(r+="\n\nDetalles: ".concat(t.details))),t.debug&&console.error("Debug info:",t.debug)}return r}async function r(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;try{let r=await fetch(e,a);if(!r.ok){let e=await t(r,s);throw Error(e)}return r}catch(e){if("TypeError"===e.name&&e.message.includes("fetch"))throw console.error("=== NETWORK ERROR ===",{route:s.route,operation:s.operation,error:e.message,timestamp:new Date().toISOString()}),Error("Error de conexi\xf3n. Verifica tu conexi\xf3n a internet o si el servidor est\xe1 disponible.");throw e}}s.d(a,{q:()=>r})},6564:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>o});var t=s(5155),r=s(2115),l=s(7969),n=s(2712);function o(){let[e,a]=(0,r.useState)([]),[s,o]=(0,r.useState)([]),[i,c]=(0,r.useState)(null),[d,x]=(0,r.useState)(!1),[m,u]=(0,r.useState)(!1),[h,p]=(0,r.useState)(""),g=async()=>{try{let e=await (0,n.q)("/api/reservas",{},{route:"/api/reservas",operation:"load_reservas"}),s=await e.json();if(Array.isArray(s))return a(s),s;return a([]),[]}catch(e){return console.error("Error loading reservas:",e),a([]),[]}},f=async()=>{try{let e=await (0,n.q)("/api/clases",{},{route:"/api/clases",operation:"load_clases"}),a=await e.json();if(Array.isArray(a))return o(a),a;return o([]),[]}catch(e){return console.error("Error loading clases:",e),o([]),[]}},y=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e||confirm("\xbfGenerar reservas aleatorias para varios alumnos? Esto crear\xe1 reservas aleatorias.")){u(!0);try{let a=await (0,n.q)("/api/reservas/generate-random",{method:"POST",headers:{"Content-Type":"application/json"}},{route:"/api/reservas/generate-random",operation:"generate_random_reservas"}),s=await a.json();a.ok?(e||alert(s.message||"Reservas generadas correctamente"),await g()):e||alert(s.error||"Error al generar reservas")}catch(a){e||alert(a.message||"Error al generar reservas")}finally{u(!1)}}};(0,r.useEffect)(()=>{(async()=>{let e=await f(),a=await g();if(Array.isArray(a)&&0===a.length&&Array.isArray(e)&&e.length>0)try{let e=await (0,n.q)("/api/usuarios",{},{route:"/api/usuarios",operation:"load_usuarios"}),a=await e.json();Array.isArray(a)&&a.filter(e=>e.activo).length>0&&await y(!0)}catch(e){console.error("Error al verificar usuarios:",e)}})()},[]);let v=e=>({Lun:"Lunes",Mar:"Martes",Jue:"Jueves",Sab:"S\xe1bado"})[e]||e,b=(()=>{if(!s||0===s.length)return[];let a=new Date;a.setHours(0,0,0,0);let t=[];for(let r=0;r<=30;r++){let l=new Date(a);l.setDate(a.getDate()+r);let n={1:"Lun",2:"Mar",4:"Jue",6:"Sab"}[l.getDay()];if(n){let a=s.filter(e=>e&&e.dia===n).map(a=>{let s=(e||[]).filter(e=>e&&e.clase_id===a.id);return{clase:a,fecha:new Date(l),reservas:s}});if(a.length>0){let e=new Date(Date.UTC(l.getFullYear(),l.getMonth(),l.getDate())),s=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-s);let r=new Date(Date.UTC(e.getUTCFullYear(),0,1)),o=Math.ceil(((e.getTime()-r.getTime())/864e5+1)/7);t.push({fecha:new Date(l),diaSemana:v(n),semana:o,clases:a})}}}return t})(),w=a=>e.filter(e=>e.clase_id===a),j=e=>{let a=w(e);if(!h.trim())return a;let s=h.toLowerCase();return a.filter(e=>(e.nombre||"").toLowerCase().includes(s)||(e.apellido||"").toLowerCase().includes(s)||"".concat(e.apellido,", ").concat(e.nombre).toLowerCase().includes(s))};return(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50 overflow-x-hidden",children:[(0,t.jsx)(l.A,{}),(0,t.jsxs)("div",{className:"max-w-7xl mx-auto px-2 sm:px-4 lg:px-8 py-4 sm:py-6 lg:py-8",children:[(0,t.jsx)("div",{className:"mb-4 sm:mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900",children:"Calendario"}),(0,t.jsx)("p",{className:"text-gray-600 mt-1 sm:mt-2 text-sm sm:text-base",children:"Pr\xf3ximos 30 d\xedas - Haz click en una clase para ver los alumnos inscritos"})]})}),0===b.length?(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-8 text-center",children:[(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"No hay clases disponibles."}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:'Por favor, inicializa las clases desde la secci\xf3n "Clases".'})]}):(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:(0,t.jsx)("div",{className:"p-4 sm:p-6",children:(0,t.jsx)("div",{className:"space-y-6",children:b.map((e,a)=>(0,t.jsxs)("div",{className:"border-b border-gray-200 pb-6 last:border-b-0 last:pb-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,t.jsx)("span",{className:"font-semibold text-gray-900 text-lg",children:e.fecha.toLocaleDateString("es-AR",{weekday:"long",day:"numeric",month:"long"})}),(0,t.jsxs)("span",{className:"text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded",children:["Semana ",e.semana]})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:e.clases.map((e,a)=>(0,t.jsxs)("button",{onClick:()=>{c({clase:e.clase,fecha:e.fecha}),x(!0)},className:"bg-gray-50 hover:bg-purple-50 border-2 border-gray-200 hover:border-purple-300 p-4 rounded-lg transition-all text-left cursor-pointer",children:[(0,t.jsx)("div",{className:"font-medium text-gray-900 mb-1",children:e.clase.nombre}),(0,t.jsx)("div",{className:"text-sm text-gray-600 mb-2",children:e.clase.hora}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:[e.reservas.length," ",1===e.reservas.length?"alumno inscrito":"alumnos inscritos"]})]},a))})]},a))})})}),d&&i&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4",onClick:()=>{x(!1),c(null)},children:(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[95vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,t.jsx)("div",{className:"p-4 sm:p-6 flex-shrink-0 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h2",{className:"text-lg sm:text-xl lg:text-2xl font-semibold pr-2",children:[i.clase.nombre," - ",i.fecha.toLocaleDateString("es-AR",{weekday:"long",day:"numeric",month:"long"})]}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:i.clase.hora})]}),(0,t.jsx)("button",{onClick:()=>{x(!1),c(null)},className:"text-gray-500 hover:text-gray-700 text-xl sm:text-2xl flex-shrink-0",children:"✕"})]})}),(0,t.jsx)("div",{className:"overflow-y-auto flex-1 p-4 sm:p-6",children:0===w(i.clase.id).length?(0,t.jsx)("p",{className:"text-gray-600 text-center py-8",children:"No hay alumnos inscritos en esta clase."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("input",{type:"text",placeholder:"Buscar alumno por nombre...",value:h,onChange:e=>p(e.target.value),className:"w-full px-4 py-2 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-gray-900 placeholder:text-gray-500"}),(0,t.jsx)("svg",{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),h&&(0,t.jsx)("button",{onClick:()=>p(""),className:"absolute right-3 top-2.5 text-gray-400 hover:text-gray-600",children:"✕"})]}),h&&(0,t.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:["Mostrando ",j(i.clase.id).length," de ",w(i.clase.id).length," alumnos"]})]}),0===j(i.clase.id).length?(0,t.jsx)("p",{className:"text-gray-600 text-center py-8",children:"No se encontraron alumnos que coincidan con la b\xfasqueda."}):(0,t.jsx)("div",{className:"space-y-1",children:j(i.clase.id).map((e,a)=>(0,t.jsx)("div",{className:"flex items-center justify-between px-3 py-1.5 rounded-lg border border-gray-200 bg-gray-50",children:(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[e.apellido,", ",e.nombre]})})},a))})]})}),(0,t.jsx)("div",{className:"p-4 sm:p-6 flex-shrink-0 border-t border-gray-200",children:(0,t.jsx)("button",{onClick:()=>{x(!1),c(null),p("")},className:"w-full bg-purple-600 text-white px-4 py-3 rounded-lg hover:bg-purple-700 transition-colors font-medium text-base",children:"Cerrar"})})]})})]})]})}},7969:(e,a,s)=>{"use strict";s.d(a,{A:()=>o});var t=s(5155),r=s(6874),l=s.n(r),n=s(5695);function o(){let e=(0,n.useRouter)(),a=async()=>{await fetch("/api/auth/logout",{method:"POST"}),e.push("/login"),e.refresh()};return(0,t.jsx)("nav",{className:"bg-purple-600 text-white shadow-lg sticky top-0 z-50",children:(0,t.jsx)("div",{className:"max-w-7xl mx-auto px-2 sm:px-4 lg:px-8",children:(0,t.jsxs)("div",{className:"flex justify-between items-center h-14 sm:h-16",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-4 lg:space-x-8 overflow-x-auto",children:[(0,t.jsx)(l(),{href:"/",className:"text-lg sm:text-xl font-bold whitespace-nowrap",children:"Clases Bot"}),(0,t.jsx)(l(),{href:"/usuarios",className:"hover:text-purple-200 transition-colors text-sm sm:text-base whitespace-nowrap",children:"Alumnos"}),(0,t.jsx)(l(),{href:"/clases",className:"hover:text-purple-200 transition-colors text-sm sm:text-base whitespace-nowrap",children:"Clases"}),(0,t.jsx)(l(),{href:"/calendario",className:"hover:text-purple-200 transition-colors text-sm sm:text-base whitespace-nowrap",children:"Calendario"})]}),(0,t.jsx)("button",{onClick:a,className:"hover:text-purple-200 transition-colors text-xs sm:text-sm whitespace-nowrap px-2 sm:px-0",children:"Salir"})]})})})}},8167:(e,a,s)=>{Promise.resolve().then(s.bind(s,6564))}},e=>{e.O(0,[244,441,964,358],()=>e(e.s=8167)),_N_E=e.O()}]);