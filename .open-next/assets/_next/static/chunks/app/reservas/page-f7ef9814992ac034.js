(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[194],{390:(e,a,s)=>{Promise.resolve().then(s.bind(s,1955))},1955:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>i});var r=s(5155),t=s(2115),l=s(7969),o=s(2712);function i(){let[e,a]=(0,t.useState)([]),[s,i]=(0,t.useState)([]),[n,c]=(0,t.useState)([]),[d,u]=(0,t.useState)(!1),[x,p]=(0,t.useState)(""),[h,m]=(0,t.useState)({usuario_id:0,clase_id:0});(0,t.useEffect)(()=>{g(),y(),v()},[]);let g=async()=>{try{let e=await (0,o.q)("/api/reservas",{},{route:"/api/reservas",operation:"load_reservas"}),s=await e.json();Array.isArray(s)?a(s):a([])}catch(e){console.error("Error loading reservas:",e),alert(e.message||"Error al cargar reservas"),a([])}},y=async()=>{try{let e=await (0,o.q)("/api/usuarios",{},{route:"/api/usuarios",operation:"load_usuarios"}),a=await e.json();Array.isArray(a)?i(a):i([])}catch(e){console.error("Error loading usuarios:",e),alert(e.message||"Error al cargar usuarios"),i([])}},v=async()=>{try{let e=await (0,o.q)("/api/clases",{},{route:"/api/clases",operation:"load_clases"}),a=await e.json();Array.isArray(a)?c(a):c([])}catch(e){console.error("Error loading clases:",e),alert(e.message||"Error al cargar clases"),c([])}},b=async e=>{e.preventDefault();try{await (0,o.q)("/api/reservas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({usuario_id:h.usuario_id,clase_id:h.clase_id})},{route:"/api/reservas",operation:"create_reserva"}),u(!1),m({usuario_id:0,clase_id:0}),g()}catch(e){alert(e.message||"Error al guardar")}},f=async(e,a)=>{if(confirm("\xbfEst\xe1s seguro de eliminar esta reserva?"))try{await (0,o.q)("/api/reservas?usuario_id=".concat(e,"&clase_id=").concat(a),{method:"DELETE"},{route:"/api/reservas",operation:"delete_reserva"}),g()}catch(e){alert(e.message||"Error al eliminar")}},j=e.filter(e=>{var a;if(!x)return!0;let s=x.toLowerCase();return(e.nombre||"").toLowerCase().includes(s)||(e.apellido||"").toLowerCase().includes(s)||(e.email||"").toLowerCase().includes(s)||(({Lun:"Lunes",Mar:"Martes",Jue:"Jueves",Sab:"S\xe1bado"})[a=e.dia]||a).toLowerCase().includes(s)||e.dia.toLowerCase().includes(s)||e.hora.toLowerCase().includes(s)||(e.clase_nombre||"").toLowerCase().includes(s)});return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)(l.A,{}),(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold text-gray-900",children:"Reservas"}),(0,r.jsx)("button",{onClick:()=>{u(!0),m({usuario_id:0,clase_id:0})},className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors",children:"+ Nueva Reserva"})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"text",placeholder:"Buscar por alumno, d\xeda, hora o clase...",value:x,onChange:e=>p(e.target.value),className:"w-full px-4 py-2 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"}),(0,r.jsx)("svg",{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),x&&(0,r.jsx)("button",{onClick:()=>p(""),className:"absolute right-3 top-2.5 text-gray-400 hover:text-gray-600",children:"âœ•"})]}),x&&(0,r.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:["Mostrando ",j.length," de ",e.length," reservas"]})]}),d&&(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Nueva Reserva"}),(0,r.jsxs)("form",{onSubmit:b,className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Alumno *"}),(0,r.jsxs)("select",{value:h.usuario_id,onChange:e=>m({...h,usuario_id:parseInt(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,children:[(0,r.jsx)("option",{value:"0",children:"Seleccionar alumno"}),s.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.apellido,", ",e.nombre]},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Clase *"}),(0,r.jsxs)("select",{value:h.clase_id,onChange:e=>m({...h,clase_id:parseInt(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",required:!0,children:[(0,r.jsx)("option",{value:"0",children:"Seleccionar clase"}),n.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.dia," ",e.hora," - ",e.nombre]},e.id))]})]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{type:"submit",className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700",children:"Guardar"}),(0,r.jsx)("button",{type:"button",onClick:()=>{u(!1)},className:"bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400",children:"Cancelar"})]})]})]}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Alumno"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"D\xeda"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Hora"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Clase"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:j.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.apellido,", ",e.nombre]}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.dia}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.hora}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.clase_nombre}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,r.jsx)("button",{onClick:()=>f(e.usuario_id,e.clase_id),className:"text-red-600 hover:text-red-900",children:"Eliminar"})})]},"".concat(e.usuario_id,"-").concat(e.clase_id)))})]})})]})]})}},2712:(e,a,s)=>{"use strict";async function r(e,a){let s="Error desconocido",r=null;try{let a=e.headers.get("content-type");s=a&&a.includes("application/json")?(null==(r=await e.json())?void 0:r.error)||s:await e.text()||"HTTP ".concat(e.status,": ").concat(e.statusText)}catch(a){s="Error al procesar respuesta: ".concat(e.status," ").concat(e.statusText)}console.error("=== API ERROR ===",{route:a.route,operation:a.operation,status:e.status,statusText:e.statusText,errorDetails:r,timestamp:new Date().toISOString()});let t=s;if(r){var l,o,i;((null==(l=r.details)?void 0:l.includes("Database"))||(null==(o=r.details)?void 0:o.includes("D1"))||(null==(i=r.details)?void 0:i.includes("binding")))&&(t="Error de base de datos: "+s,"cloudflare"===r.environment&&(t+="\n\nVerifica la configuraci\xf3n de D1 en Cloudflare Pages.")),r.details&&r.details!==s&&(console.error("Error details:",r.details),"localhost"===window.location.hostname&&(t+="\n\nDetalles: ".concat(r.details))),r.debug&&console.error("Debug info:",r.debug)}return t}async function t(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;try{let t=await fetch(e,a);if(!t.ok){let e=await r(t,s);throw Error(e)}return t}catch(e){if("TypeError"===e.name&&e.message.includes("fetch"))throw console.error("=== NETWORK ERROR ===",{route:s.route,operation:s.operation,error:e.message,timestamp:new Date().toISOString()}),Error("Error de conexi\xf3n. Verifica tu conexi\xf3n a internet o si el servidor est\xe1 disponible.");throw e}}s.d(a,{q:()=>t})},7969:(e,a,s)=>{"use strict";s.d(a,{A:()=>i});var r=s(5155),t=s(6874),l=s.n(t),o=s(5695);function i(){let e=(0,o.useRouter)(),a=async()=>{await fetch("/api/auth/logout",{method:"POST"}),e.push("/login"),e.refresh()};return(0,r.jsx)("nav",{className:"bg-purple-600 text-white shadow-lg",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between h-16",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-8",children:[(0,r.jsx)(l(),{href:"/",className:"text-xl font-bold",children:"Clases Bot"}),(0,r.jsx)(l(),{href:"/usuarios",className:"hover:text-purple-200 transition-colors",children:"Alumnos"}),(0,r.jsx)(l(),{href:"/clases",className:"hover:text-purple-200 transition-colors",children:"Clases"}),(0,r.jsx)(l(),{href:"/reservas",className:"hover:text-purple-200 transition-colors",children:"Reservas"})]}),(0,r.jsx)("button",{onClick:a,className:"hover:text-purple-200 transition-colors",children:"Cerrar Sesi\xf3n"})]})})})}}},e=>{e.O(0,[244,441,964,358],()=>e(e.s=390)),_N_E=e.O()}]);