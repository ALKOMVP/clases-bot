(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[194],{390:(e,s,a)=>{Promise.resolve().then(a.bind(a,1955))},1955:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>i});var t=a(5155),r=a(2115),l=a(7969),n=a(2712);function i(){let[e,s]=(0,r.useState)([]),[a,i]=(0,r.useState)([]),[o,c]=(0,r.useState)(null),[d,x]=(0,r.useState)(!1),[m,h]=(0,r.useState)(!1);(0,r.useEffect)(()=>{p(),u()},[]);let p=async()=>{try{let e=await (0,n.q)("/api/reservas",{},{route:"/api/reservas",operation:"load_reservas"}),a=await e.json();Array.isArray(a)?s(a):s([])}catch(e){console.error("Error loading reservas:",e),s([])}},u=async()=>{try{let e=await (0,n.q)("/api/clases",{},{route:"/api/clases",operation:"load_clases"}),s=await e.json();Array.isArray(s)?i(s):i([])}catch(e){console.error("Error loading clases:",e),i([])}},g=e=>({Lun:"Lunes",Mar:"Martes",Jue:"Jueves",Sab:"S\xe1bado"})[e]||e,f=(()=>{let s=new Date;s.setHours(0,0,0,0);let t=[];for(let r=0;r<30;r++){let l=new Date(s);l.setDate(s.getDate()+r);let n={1:"Lun",2:"Mar",4:"Jue",6:"Sab"}[l.getDay()];if(n){let s=a.filter(e=>e.dia===n).map(s=>{let a=e.filter(e=>e.clase_id===s.id);return{clase:s,fecha:new Date(l),reservas:a}});if(s.length>0){let e=new Date(Date.UTC(l.getFullYear(),l.getMonth(),l.getDate())),a=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-a);let r=new Date(Date.UTC(e.getUTCFullYear(),0,1)),i=Math.ceil(((e.getTime()-r.getTime())/864e5+1)/7);t.push({fecha:new Date(l),diaSemana:g(n),semana:i,clases:s})}}}return t})(),b=s=>e.filter(e=>e.clase_id===s),v=async()=>{if(confirm("\xbfGenerar reservas aleatorias para varios alumnos? Esto crear\xe1 reservas aleatorias.")){h(!0);try{let e=await (0,n.q)("/api/reservas/generate-random",{method:"POST",headers:{"Content-Type":"application/json"}},{route:"/api/reservas/generate-random",operation:"generate_random_reservas"}),s=await e.json();e.ok?(alert(s.message||"Reservas generadas correctamente"),p()):alert(s.error||"Error al generar reservas")}catch(e){alert(e.message||"Error al generar reservas")}finally{h(!1)}}};return(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50 overflow-x-hidden",children:[(0,t.jsx)(l.A,{}),(0,t.jsxs)("div",{className:"max-w-7xl mx-auto px-2 sm:px-4 lg:px-8 py-4 sm:py-6 lg:py-8",children:[(0,t.jsxs)("div",{className:"mb-4 sm:mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900",children:"Calendario"}),(0,t.jsx)("p",{className:"text-gray-600 mt-1 sm:mt-2 text-sm sm:text-base",children:"Pr\xf3ximos 30 d\xedas - Haz click en una clase para ver los alumnos inscritos"})]}),(0,t.jsx)("button",{onClick:v,disabled:m,className:"bg-green-600 text-white px-3 sm:px-4 py-2 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 text-sm sm:text-base w-full sm:w-auto",children:m?"Generando...":"Generar Reservas Aleatorias"})]}),0===f.length?(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-8 text-center",children:[(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"No hay clases disponibles."}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:'Por favor, inicializa las clases desde la secci\xf3n "Clases".'})]}):(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:(0,t.jsx)("div",{className:"p-4 sm:p-6",children:(0,t.jsx)("div",{className:"space-y-6",children:f.map((e,s)=>(0,t.jsxs)("div",{className:"border-b border-gray-200 pb-6 last:border-b-0 last:pb-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,t.jsx)("span",{className:"font-semibold text-gray-900 text-lg",children:e.fecha.toLocaleDateString("es-AR",{weekday:"long",day:"numeric",month:"long"})}),(0,t.jsxs)("span",{className:"text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded",children:["Semana ",e.semana]})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:e.clases.map((e,s)=>(0,t.jsxs)("button",{onClick:()=>{c({clase:e.clase,fecha:e.fecha}),x(!0)},className:"bg-gray-50 hover:bg-purple-50 border-2 border-gray-200 hover:border-purple-300 p-4 rounded-lg transition-all text-left cursor-pointer",children:[(0,t.jsx)("div",{className:"font-medium text-gray-900 mb-1",children:e.clase.nombre}),(0,t.jsx)("div",{className:"text-sm text-gray-600 mb-2",children:e.clase.hora}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:[e.reservas.length," ",1===e.reservas.length?"alumno inscrito":"alumnos inscritos"]})]},s))})]},s))})})}),d&&o&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4",onClick:()=>{x(!1),c(null)},children:(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[95vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,t.jsx)("div",{className:"p-4 sm:p-6 flex-shrink-0 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h2",{className:"text-lg sm:text-xl lg:text-2xl font-semibold pr-2",children:[o.clase.nombre," - ",o.fecha.toLocaleDateString("es-AR",{weekday:"long",day:"numeric",month:"long"})]}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:o.clase.hora})]}),(0,t.jsx)("button",{onClick:()=>{x(!1),c(null)},className:"text-gray-500 hover:text-gray-700 text-xl sm:text-2xl flex-shrink-0",children:"âœ•"})]})}),(0,t.jsx)("div",{className:"overflow-y-auto flex-1 p-4 sm:p-6",children:0===b(o.clase.id).length?(0,t.jsx)("p",{className:"text-gray-600 text-center py-8",children:"No hay alumnos inscritos en esta clase."}):(0,t.jsx)("div",{className:"space-y-1",children:b(o.clase.id).map((e,s)=>(0,t.jsx)("div",{className:"flex items-center justify-between px-3 py-1.5 rounded-lg border border-gray-200 bg-gray-50",children:(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[e.apellido,", ",e.nombre]})})},s))})}),(0,t.jsx)("div",{className:"p-4 sm:p-6 flex-shrink-0 border-t border-gray-200",children:(0,t.jsx)("button",{onClick:()=>{x(!1),c(null)},className:"w-full bg-purple-600 text-white px-4 py-3 rounded-lg hover:bg-purple-700 transition-colors font-medium text-base",children:"Cerrar"})})]})})]})]})}},2712:(e,s,a)=>{"use strict";async function t(e,s){let a="Error desconocido",t=null;try{let s=e.headers.get("content-type");a=s&&s.includes("application/json")?(null==(t=await e.json())?void 0:t.error)||a:await e.text()||"HTTP ".concat(e.status,": ").concat(e.statusText)}catch(s){a="Error al procesar respuesta: ".concat(e.status," ").concat(e.statusText)}console.error("=== API ERROR ===",{route:s.route,operation:s.operation,status:e.status,statusText:e.statusText,errorDetails:t,timestamp:new Date().toISOString()});let r=a;if(t){var l,n,i;((null==(l=t.details)?void 0:l.includes("Database"))||(null==(n=t.details)?void 0:n.includes("D1"))||(null==(i=t.details)?void 0:i.includes("binding")))&&(r="Error de base de datos: "+a,"cloudflare"===t.environment&&(r+="\n\nVerifica la configuraci\xf3n de D1 en Cloudflare Pages.")),t.details&&t.details!==a&&(console.error("Error details:",t.details),"localhost"===window.location.hostname&&(r+="\n\nDetalles: ".concat(t.details))),t.debug&&console.error("Debug info:",t.debug)}return r}async function r(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;try{let r=await fetch(e,s);if(!r.ok){let e=await t(r,a);throw Error(e)}return r}catch(e){if("TypeError"===e.name&&e.message.includes("fetch"))throw console.error("=== NETWORK ERROR ===",{route:a.route,operation:a.operation,error:e.message,timestamp:new Date().toISOString()}),Error("Error de conexi\xf3n. Verifica tu conexi\xf3n a internet o si el servidor est\xe1 disponible.");throw e}}a.d(s,{q:()=>r})},7969:(e,s,a)=>{"use strict";a.d(s,{A:()=>i});var t=a(5155),r=a(6874),l=a.n(r),n=a(5695);function i(){let e=(0,n.useRouter)(),s=async()=>{await fetch("/api/auth/logout",{method:"POST"}),e.push("/login"),e.refresh()};return(0,t.jsx)("nav",{className:"bg-purple-600 text-white shadow-lg sticky top-0 z-50",children:(0,t.jsx)("div",{className:"max-w-7xl mx-auto px-2 sm:px-4 lg:px-8",children:(0,t.jsxs)("div",{className:"flex justify-between items-center h-14 sm:h-16",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-4 lg:space-x-8 overflow-x-auto",children:[(0,t.jsx)(l(),{href:"/",className:"text-lg sm:text-xl font-bold whitespace-nowrap",children:"Clases Bot"}),(0,t.jsx)(l(),{href:"/usuarios",className:"hover:text-purple-200 transition-colors text-sm sm:text-base whitespace-nowrap",children:"Alumnos"}),(0,t.jsx)(l(),{href:"/clases",className:"hover:text-purple-200 transition-colors text-sm sm:text-base whitespace-nowrap",children:"Clases"}),(0,t.jsx)(l(),{href:"/calendario",className:"hover:text-purple-200 transition-colors text-sm sm:text-base whitespace-nowrap",children:"Calendario"})]}),(0,t.jsx)("button",{onClick:s,className:"hover:text-purple-200 transition-colors text-xs sm:text-sm whitespace-nowrap px-2 sm:px-0",children:"Salir"})]})})})}}},e=>{e.O(0,[244,441,964,358],()=>e(e.s=390)),_N_E=e.O()}]);