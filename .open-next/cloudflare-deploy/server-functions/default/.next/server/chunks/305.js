exports.id=305,exports.ids=[305],exports.modules={857:(a,b,c)=>{"use strict";c.d(b,{WX:()=>f,cR:()=>e});var d=c(2190);function e(){return{environment:"local",isCloudflare:!1,isDevelopment:"undefined"!=typeof process&&!1,nodeEnv:"undefined"!=typeof process?"production":"unknown"}}function f(a,b,c){let f,g=e(),h=a?.message||String(a),i=a?.name||"UnknownError";console.error("=== ERROR DETAILS ===",{environment:g.environment,route:c?.route||"unknown",method:c?.method||"unknown",operation:c?.operation||"unknown",errorName:i,errorMessage:h,stack:a?.stack,fullError:String(a),timestamp:new Date().toISOString()});let j=500,k=b;"Database not available"===h||"DB not available"===h||h.includes("D1")&&h.includes("not available")||h.includes("binding")&&h.includes("not found")?(j=503,k="Base de datos no disponible",f=g.isCloudflare?"Error de configuraci\xf3n: La base de datos D1 no est\xe1 configurada correctamente en Cloudflare Pages. Verifica el binding en el dashboard.":"Error de configuraci\xf3n: La base de datos no est\xe1 disponible en el entorno local."):h.includes("UNIQUE constraint")||h.includes("constraint")?(j=400,k=h.includes("email")?"El email ya existe":h.includes("reserva")||h.includes("clase")?"Ya existe un registro con estos datos":"Datos duplicados"):h.includes("Faltan")||h.includes("required")||h.includes("invalid")?(j=400,k=h.includes("Faltan")?h:"Datos inv\xe1lidos"):h.includes("Cloudflare")||h.includes("edge runtime")||h.includes("getOptionalRequestContext")?(j=500,k="Error del servidor (Cloudflare)",f=g.isCloudflare?"Error en el runtime de Cloudflare. Verifica la configuraci\xf3n del proyecto.":"Error de compatibilidad con Cloudflare Pages."):(j=500,k=b,g.isDevelopment&&(f=h));let l={error:k,environment:g.environment,timestamp:new Date().toISOString()};return(f||g.isDevelopment)&&(l.details=f||h),g.isDevelopment&&(l.debug={errorName:i,route:c?.route,method:c?.method,operation:c?.operation}),d.NextResponse.json(l,{status:j})}},6487:()=>{},8335:()=>{},9949:(a,b,c)=>{"use strict";function d(a){if(!a||!a.id||a.dni)return null;let b=String(a.email||"").trim(),c=String(a.apellido||"").trim(),d=String(a.nombre||"").trim(),e=/^\d{4}-\d{2}-\d{2}$/.test(b),f=c.includes("@"),g=d.includes("@"),h=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(b);if(e||f||g||!h||!d||!c||!b)return null;let i={};return i.id=Number(a.id),i.nombre=d,i.apellido=c,i.email=b.toLowerCase(),i.fecha_alta=a.fecha_alta?String(a.fecha_alta).trim():new Date().toISOString().split("T")[0],i}function e(){let a;"undefined"!=typeof globalThis?(globalThis.__mockDBData||(globalThis.__mockDBData={usuarios:[],clases:[],reservas:[]}),a=globalThis.__mockDBData):(global.__mockDBData||(global.__mockDBData={usuarios:[],clases:[],reservas:[]}),a=global.__mockDBData);let b=a.usuarios.filter(a=>!a||!a.dni).map(a=>d(a)).filter(a=>null!==a),c=new Set;return a.usuarios=b.filter(a=>{if(!a||!a.email)return!1;let b=String(a.email).toLowerCase().trim();return!c.has(b)&&(c.add(b),!0)}),a}c.d(b,{O:()=>g});class f{get data(){return e()}prepare(a){return{bind:(...b)=>{let c=Array.isArray(b[0])?b[0]:b;return{first:async()=>{let b=e();if(a.includes("SELECT")&&a.includes("WHERE")&&a.includes("usuario")&&a.includes("id")){let a=b.usuarios.find(a=>a.id===parseInt(c[0]));return a?d(a):null}return null},all:async()=>{let b=e();if(a.includes("FROM usuario")){let c=b.usuarios.filter(a=>!a||!a.dni).map(a=>d(a)).filter(a=>null!==a);return a.includes("ORDER BY")&&a.includes("ORDER BY apellido, nombre")&&c.sort((a,b)=>{let c=(a.apellido||"").localeCompare(b.apellido||"");return 0!==c?c:(a.nombre||"").localeCompare(b.nombre||"")}),{results:c}}if(a.includes("FROM clase")){let c=[...b.clases];if(a.includes("ORDER BY dia, hora")){let a={Lun:1,Mar:2,Jue:3,Sab:4};c.sort((b,c)=>{let d=a[b.dia]||99,e=a[c.dia]||99;return d!==e?d-e:(b.hora||"").localeCompare(c.hora||"")})}return{results:c}}if(a.includes("FROM reserva")){let d=[];if(a.includes("JOIN usuario")||a.includes("JOIN clase"))for(let a of b.reservas){let c=b.usuarios.find(b=>b.id===a.usuario_id),e=b.clases.find(b=>b.id===a.clase_id);c&&e&&d.push({...a,nombre:c.nombre,apellido:c.apellido,email:c.email,dia:e.dia,hora:e.hora,clase_nombre:e.nombre})}else d=[...b.reservas];if(a.includes("WHERE")&&c.length>0&&(a.includes("r.usuario_id = ?")&&(d=d.filter(a=>a.usuario_id===parseInt(c[0]))),a.includes("r.clase_id = ?")&&(d=d.filter(a=>a.clase_id===parseInt(c[0])))),a.includes("ORDER BY")&&a.includes("ORDER BY c.dia, c.hora")){let a={Lun:1,Mar:2,Jue:3,Sab:4};d.sort((b,c)=>{let d=a[b.dia]||99,e=a[c.dia]||99;return d!==e?d-e:(b.hora||"").localeCompare(c.hora||"")})}return{results:d}}return{results:[]}},run:async()=>{let b=e();try{if(a.includes("INSERT INTO usuario")){let a=b.usuarios.length>0?Math.max(...b.usuarios.map(a=>a.id||0)):0;if(console.log("INSERT usuario - Par\xe1metros recibidos:",c),console.log("INSERT usuario - N\xfamero de par\xe1metros:",c.length),c.length<3)throw Error("Faltan par\xe1metros requeridos");let e=String(c[0]||"").trim(),f=String(c[1]||"").trim(),g=String(c[2]||"").toLowerCase().trim(),h=c[3]?String(c[3]).trim():new Date().toISOString().split("T")[0];if(console.log("INSERT usuario - Valores extra\xeddos:",{nombre:e,apellido:f,email:g,fechaAlta:h}),e.includes("@"))throw console.error("ERROR: nombre contiene @, esto indica que los par\xe1metros est\xe1n desordenados"),Error("Error: el nombre no puede ser un email. Verifique el orden de los campos.");if(f.includes("@")&&!g.includes("@"))throw console.error("ERROR: apellido contiene @ pero email no, esto indica que los par\xe1metros est\xe1n desordenados"),Error("Error: el apellido no puede ser un email. Verifique el orden de los campos.");if(!e||!f||!g)throw Error("Faltan campos requeridos");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(g)||/^\d{4}-\d{2}-\d{2}$/.test(g))throw Error("Email inv\xe1lido");let i={};if(i.id=a+1,i.nombre=e,i.apellido=f,i.email=g,i.fecha_alta=h,console.log("INSERT usuario - Usuario creado:",i),!i.id||!i.nombre||!i.apellido||!i.email)throw Error("Error al crear usuario: estructura inv\xe1lida");if(i.nombre.includes("@"))throw Error("Error: el nombre contiene un email. Los par\xe1metros pueden estar en el orden incorrecto.");if(i.apellido.includes("@"))throw Error("Error: el apellido contiene un email. Los par\xe1metros pueden estar en el orden incorrecto.");b.usuarios=b.usuarios.filter(a=>{if(!a||!a.id||!a.email||!a.nombre||!a.apellido)return!1;let b=String(a.email||""),c=String(a.apellido||""),d=String(a.nombre||"");return!(/^\d{4}-\d{2}-\d{2}$/.test(b)||c.includes("@")||d.includes("@"))&&!!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(b)}).map(a=>d(a)).filter(a=>null!==a);let j=b.usuarios.map(a=>d(a)).filter(a=>null!==a),k=i.email.toLowerCase().trim(),l=j.findIndex(a=>!!a&&!!a.email&&String(a.email).toLowerCase().trim()===k);if(-1===l){let a={};return a.id=i.id,a.nombre=i.nombre,a.apellido=i.apellido,a.email=i.email,a.fecha_alta=i.fecha_alta,console.log("INSERT usuario - Usuario limpio a guardar:",a),b.usuarios=j,b.usuarios.push(a),console.log("INSERT usuario - Usuario guardado en array:",b.usuarios[b.usuarios.length-1]),{success:!0,meta:{last_row_id:i.id,changes:1}}}throw Error("UNIQUE constraint failed: usuario.email")}if(a.includes("INSERT INTO clase")){let a={id:(b.clases.length>0?Math.max(...b.clases.map(a=>a.id||0)):0)+1,dia:c[0],hora:c[1],nombre:c[2]||"Yoga"},d=b.clases.findIndex(b=>b.dia===a.dia&&b.hora===a.hora);if(-1===d)return b.clases.push(a),{success:!0,meta:{last_row_id:a.id,changes:1}};throw Error("UNIQUE constraint failed: clase.dia, clase.hora")}if(a.includes("INSERT INTO reserva")){let a={usuario_id:c[0],clase_id:c[1],created_at:new Date().toISOString()},d=b.reservas.findIndex(b=>b.usuario_id===a.usuario_id&&b.clase_id===a.clase_id);if(-1===d)return b.reservas.push(a),{success:!0,meta:{changes:1}};throw Error("UNIQUE constraint failed: reserva.usuario_id, reserva.clase_id")}if(a.includes("UPDATE usuario")){let a=c[4],d=b.usuarios.findIndex(b=>b.id===a);if(-1!==d){let a=c[2]?.toLowerCase().trim()||c[2],e=b.usuarios.findIndex((b,c)=>c!==d&&b.email?.toLowerCase().trim()===a);if(-1===e)return b.usuarios[d]={...b.usuarios[d],nombre:c[0],apellido:c[1],email:a,fecha_alta:c[3]},{success:!0,meta:{changes:1}};throw Error("UNIQUE constraint failed: usuario.email")}return{success:!0,meta:{changes:0}}}if(a.includes("UPDATE clase"),a.includes("UPDATE reserva"),a.includes("DELETE FROM usuario")){let a=b.usuarios.length;b.usuarios=b.usuarios.filter(a=>a.id!==parseInt(c[0]));let d=a-b.usuarios.length;return{success:!0,meta:{changes:d}}}if(a.includes("DELETE FROM clase")&&(b.clases=b.clases.filter(a=>a.id!==parseInt(c[0]))),a.includes("DELETE FROM reserva")){let a=b.reservas.length;b.reservas=b.reservas.filter(a=>a.usuario_id!==parseInt(c[0])||a.clase_id!==parseInt(c[1]));let d=a-b.reservas.length;return{success:!0,meta:{changes:d}}}return{success:!0,meta:{changes:0}}}catch(a){throw a}}}},first:async()=>(e(),a.includes("SELECT")&&a.includes("WHERE")&&a.includes("usuario")&&a.includes("id"),null),all:async()=>{let b=e();if(a.includes("FROM usuario")){let c=b.usuarios.filter(a=>!a||!a.dni).map(a=>d(a)).filter(a=>null!==a);return a.includes("ORDER BY")&&a.includes("ORDER BY apellido, nombre")&&c.sort((a,b)=>{let c=(a.apellido||"").localeCompare(b.apellido||"");return 0!==c?c:(a.nombre||"").localeCompare(b.nombre||"")}),{results:c}}if(a.includes("FROM clase")){let c=[...b.clases];if(a.includes("ORDER BY dia, hora")){let a={Lun:1,Mar:2,Jue:3,Sab:4};c.sort((b,c)=>{let d=a[b.dia]||99,e=a[c.dia]||99;return d!==e?d-e:(b.hora||"").localeCompare(c.hora||"")})}return{results:c}}if(a.includes("FROM reserva")){let c=[];if(a.includes("JOIN usuario")||a.includes("JOIN clase"))for(let a of b.reservas){let d=b.usuarios.find(b=>b.id===a.usuario_id),e=b.clases.find(b=>b.id===a.clase_id);d&&e&&c.push({...a,nombre:d.nombre,apellido:d.apellido,email:d.email,dia:e.dia,hora:e.hora,clase_nombre:e.nombre})}else c=[...b.reservas];return{results:c}}return{results:[]}},run:async()=>{e(),a.includes("INSERT INTO usuario")}}}}function g(){return"undefined"!=typeof globalThis?(globalThis.__mockDBInstance||(globalThis.__mockDBInstance=new f),globalThis.__mockDBInstance):(global.__mockDBInstance||(global.__mockDBInstance=new f),global.__mockDBInstance)}}};